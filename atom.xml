<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>XuKun&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/60330ab14f15207afe731bc5db91eef1</icon>
  <subtitle>做最好的自己！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://xukun.fun/"/>
  <updated>2020-07-27T15:44:05.531Z</updated>
  <id>http://xukun.fun/</id>
  
  <author>
    <name>蔚蓝海</name>
    <email>471031576@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CentOS7下MariaDB、JDK及Redis安装与配置</title>
    <link href="http://xukun.fun/2020/07/27/CentOS7%E4%B8%8BMariaDB%E3%80%81JDK%E5%8F%8ARedis%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/"/>
    <id>http://xukun.fun/2020/07/27/CentOS7%E4%B8%8BMariaDB%E3%80%81JDK%E5%8F%8ARedis%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/</id>
    <published>2020-07-27T14:59:46.000Z</published>
    <updated>2020-07-27T15:44:05.531Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MariaDB安装与配置"><a href="#MariaDB安装与配置" class="headerlink" title="MariaDB安装与配置"></a>MariaDB安装与配置</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p>MariaDB数据库管理系统是MySQL的一个分支，主要由开源社区在维护，采用GPL授权许可 MariaDB的目的是完全兼容MySQL，包括API和命令行，使之能轻松成为MySQL的代替品。开发这个分支的原因之一是：甲骨文公司收购了MySQL后，有将MySQL闭源的潜在风险，因此社区采用分支的方式来避开这个风险。</p></blockquote><h2 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h2><ul><li>查看系统版本</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# cat &#x2F;etc&#x2F;redhat-release</span><br><span class="line">CentOS Linux release 7.7.1908 (Core)</span><br></pre></td></tr></table></figure><ul><li>查看是否已经安装</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# rpm -qa | grep mariadb</span><br><span class="line">mariadb-libs-5.5.65-1.el7.x86_64</span><br><span class="line">mariadb-server-5.5.65-1.el7.x86_64</span><br><span class="line">mariadb-5.5.65-1.el7.x86_64</span><br></pre></td></tr></table></figure><ul><li>以上代表安装过，可卸载重装，卸载命令</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# yum remove mariadb-server</span><br></pre></td></tr></table></figure><h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><p>通过yum安装即可，yum命令如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# yum install mariadb-server</span><br></pre></td></tr></table></figure><ul><li>启动服务</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# systemctl start mariadb</span><br></pre></td></tr></table></figure><ul><li>若需要开机自动启动，执行以下命令即可</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# systemctl enable mariadb</span><br></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="首次配置"><a href="#首次配置" class="headerlink" title="首次配置"></a>首次配置</h3><ul><li>进行初始化配置</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# mysql_secure_installation</span><br></pre></td></tr></table></figure><ul><li>配置过程如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class="line">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!</span><br><span class="line"></span><br><span class="line">In order to log into MariaDB to secure it, we&#39;ll need the current</span><br><span class="line">password for the root user.  If you&#39;ve just installed MariaDB, and</span><br><span class="line">you haven&#39;t set the root password yet, the password will be blank,</span><br><span class="line">so you should just press enter here.</span><br><span class="line"></span><br><span class="line"># 输入数据库管理员密码，若第一次进入则直接回车</span><br><span class="line">Enter current password for root (enter for none): </span><br><span class="line">OK, successfully used password, moving on...</span><br><span class="line"></span><br><span class="line">Setting the root password ensures that nobody can log into the MariaDB</span><br><span class="line">root user without the proper authorisation.</span><br><span class="line"></span><br><span class="line"># 设置密码</span><br><span class="line">Set root password? [Y&#x2F;n] y</span><br><span class="line"># 密码</span><br><span class="line">New password: </span><br><span class="line"># 确认密码</span><br><span class="line">Re-enter new password: </span><br><span class="line">Password updated successfully!</span><br><span class="line">Reloading privilege tables..</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">By default, a MariaDB installation has an anonymous user, allowing anyone</span><br><span class="line">to log into MariaDB without having to have a user account created for</span><br><span class="line">them.  This is intended only for testing, and to make the installation</span><br><span class="line">go a bit smoother.  You should remove them before moving into a</span><br><span class="line">production environment.</span><br><span class="line"></span><br><span class="line"># 是否移除匿名用户</span><br><span class="line">Remove anonymous users? [Y&#x2F;n] y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Normally, root should only be allowed to connect from &#39;localhost&#39;.  This</span><br><span class="line">ensures that someone cannot guess at the root password from the network.</span><br><span class="line"></span><br><span class="line"># 是否拒绝远程登录</span><br><span class="line">Disallow root login remotely? [Y&#x2F;n] n</span><br><span class="line"> ... skipping.</span><br><span class="line"></span><br><span class="line">By default, MariaDB comes with a database named &#39;test&#39; that anyone can</span><br><span class="line">access.  This is also intended only for testing, and should be removed</span><br><span class="line">before moving into a production environment.</span><br><span class="line"></span><br><span class="line"># 是否移除test测试数据库</span><br><span class="line">Remove test database and access to it? [Y&#x2F;n] y</span><br><span class="line"> - Dropping test database...</span><br><span class="line"> ... Success!</span><br><span class="line"> - Removing privileges on test database...</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Reloading the privilege tables will ensure that all changes made so far</span><br><span class="line">will take effect immediately.</span><br><span class="line"></span><br><span class="line"># 是否重新加载权限库</span><br><span class="line">Reload privilege tables now? [Y&#x2F;n] y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Cleaning up...</span><br><span class="line"></span><br><span class="line">All done!  If you&#39;ve completed all of the above steps, your MariaDB</span><br><span class="line">installation should now be secure.</span><br><span class="line"></span><br><span class="line">Thanks for using MariaDB!</span><br></pre></td></tr></table></figure><ul><li>测试是否能登录成功</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 10</span><br><span class="line">Server version: 5.5.65-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br></pre></td></tr></table></figure><h3 id="配置字符集为UTF-8"><a href="#配置字符集为UTF-8" class="headerlink" title="配置字符集为UTF-8"></a>配置字符集为UTF-8</h3><ul><li>编辑/etc/my.cnf 文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# vi &#x2F;etc&#x2F;my.cnf</span><br></pre></td></tr></table></figure><ul><li>[mysqld]标签下添加如下代码</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">init_connect&#x3D;&#39;SET collation_connection &#x3D; utf8_unicode_ci&#39;</span><br><span class="line">init_connect&#x3D;&#39;SET NAMES utf8&#39;</span><br><span class="line">character-set-server&#x3D;utf8</span><br><span class="line">collation-server&#x3D;utf8_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br></pre></td></tr></table></figure><ul><li>编辑/etc/my.cnf.d/client.cnf 文件，在[client]标签下添加</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default-character-set&#x3D;utf8</span><br></pre></td></tr></table></figure><ul><li>编辑/etc/my.cnf.d/mysql-clients.cnf文件，在[mysql]标签下添加</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default-character-set&#x3D;utf8</span><br></pre></td></tr></table></figure><ul><li>重启服务后生效</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# systemctl restart mariadb</span><br></pre></td></tr></table></figure><ul><li>登录MariaDB，查看编码是否生效</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show variables like &quot;%character%&quot;;</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| Variable_name            | Value                      |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| character_set_client     | utf8                       |</span><br><span class="line">| character_set_connection | utf8                       |</span><br><span class="line">| character_set_database   | utf8                       |</span><br><span class="line">| character_set_filesystem | binary                     |</span><br><span class="line">| character_set_results    | utf8                       |</span><br><span class="line">| character_set_server     | utf8                       |</span><br><span class="line">| character_set_system     | utf8                       |</span><br><span class="line">| character_sets_dir       | &#x2F;usr&#x2F;share&#x2F;mysql&#x2F;charsets&#x2F; |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show variables like &quot;%collation%&quot;;</span><br><span class="line">+----------------------+-----------------+</span><br><span class="line">| Variable_name        | Value           |</span><br><span class="line">+----------------------+-----------------+</span><br><span class="line">| collation_connection | utf8_unicode_ci |</span><br><span class="line">| collation_database   | utf8_unicode_ci |</span><br><span class="line">| collation_server     | utf8_unicode_ci |</span><br><span class="line">+----------------------+-----------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><ul><li>修改防火墙，开启端口</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查看防火墙3306端口是否开启</span><br><span class="line">[root@xukun94 ~]# firewall-cmd --query-port&#x3D;3306&#x2F;tcp</span><br><span class="line">no</span><br><span class="line"># 开启防火墙3306端口</span><br><span class="line">[root@xukun94 ~]# firewall-cmd --zone&#x3D;public --add-port&#x3D;3306&#x2F;tcp --permanent</span><br><span class="line">success</span><br><span class="line"># 重启防火墙</span><br><span class="line">[root@xukun94 ~]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line"># 查看防火墙3306端口是否开启</span><br><span class="line">[root@xukun94 ~]# firewall-cmd --query-port&#x3D;3306&#x2F;tcp</span><br><span class="line">yes</span><br></pre></td></tr></table></figure><ul><li>设置MariaDB可远程连接</li></ul><ol><li><p>查看mysql库中user表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; use mysql</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [mysql]&gt; select host, user from user</span><br><span class="line">    -&gt; ;</span><br><span class="line">+-----------+------+</span><br><span class="line">| host      | user |</span><br><span class="line">+-----------+------+</span><br><span class="line">| 127.0.0.1 | root |</span><br><span class="line">| ::1       | root |</span><br><span class="line">| localhost | root |</span><br><span class="line">| xukun94   | root |</span><br><span class="line">+-----------+------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li><li><p>将host为当前主机名的记录，host属性修改成’%’</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; update user set host&#x3D;&#39;%&#39; where host&#x3D;&#39;xukun94&#39;;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure></li><li><p>刷新权限表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mysql]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></li></ol><p>远程连接配置完成，使用连接工具连接即可</p><h1 id="JDK1-8安装与配置"><a href="#JDK1-8安装与配置" class="headerlink" title="JDK1.8安装与配置"></a>JDK1.8安装与配置</h1><h2 id="安装准备-1"><a href="#安装准备-1" class="headerlink" title="安装准备"></a>安装准备</h2><ul><li><p>查看系统位数</p><p>I386或I686 都是32位</p><p>x86_64 是 64位</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# uname -a</span><br><span class="line">Linux xukun94 3.10.0-229.1.2.el7.x86_64 #1 SMP Fri Mar 27 03:04:26 UTC 2015 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><ul><li>进入<a href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html" target="_blank" rel="noopener">Oracle官网</a>下载JDK1.8，选择对应系统位数的rpm下载</li><li>使用xftp6等传输工具将下载好的文件上传到远程服务器中</li></ul><h2 id="开始安装-1"><a href="#开始安装-1" class="headerlink" title="开始安装"></a>开始安装</h2><p>使用rpm命令安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# rpm -ivh jdk-8u261-linux-x64.rpm</span><br></pre></td></tr></table></figure><h2 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h2><p>添加环境变量，编辑source /etc/profile文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><p>在此文件最后添加如下代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;jre&#x2F;lib&#x2F;rt.jar:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar</span><br><span class="line">export PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATH</span><br></pre></td></tr></table></figure><p>生效环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><p>查看jdk是否安装成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# java -version</span><br><span class="line">java version &quot;1.8.0_261&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_261-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.261-b12, mixed mode)</span><br></pre></td></tr></table></figure><h1 id="Redis安装与配置"><a href="#Redis安装与配置" class="headerlink" title="Redis安装与配置"></a>Redis安装与配置</h1><h2 id="安装准备-2"><a href="#安装准备-2" class="headerlink" title="安装准备"></a>安装准备</h2><ul><li>使用wget命令下载Redis5.0.9</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-5.0.9.tar.gzwget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-5.0.9.tar.gz</span><br></pre></td></tr></table></figure><ul><li>解压</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# tar xzf redis-5.0.9.tar.gz</span><br></pre></td></tr></table></figure><h2 id="开始安装-2"><a href="#开始安装-2" class="headerlink" title="开始安装"></a>开始安装</h2><ul><li>进入解压后文件夹，执行make编译命令</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 ~]# cd redis-5.0.9</span><br><span class="line">[root@xukun94 redis-5.0.9]# make</span><br></pre></td></tr></table></figure><ul><li>若遇到一下错误，说明gcc未安装，使用yum命令安装即可</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MAKE hiredis</span><br><span class="line">cd hiredis &amp;&amp; make static</span><br><span class="line">make[3]: Entering directory &#96;&#x2F;root&#x2F;redis-5.0.9&#x2F;deps&#x2F;hiredis&#39;</span><br><span class="line">gcc -std&#x3D;c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g -ggdb  net.c</span><br><span class="line">make[3]: gcc: Command not found</span><br><span class="line">make[3]: *** [net.o] Error 127</span><br><span class="line">make[3]: Leaving directory &#96;&#x2F;root&#x2F;redis-5.0.9&#x2F;deps&#x2F;hiredis&#39;</span><br><span class="line">make[2]: *** [hiredis] Error 2</span><br><span class="line">make[2]: Leaving directory &#96;&#x2F;root&#x2F;redis-5.0.9&#x2F;deps&#39;</span><br><span class="line">make[1]: [persist-settings] Error 2 (ignored)</span><br><span class="line">    CC adlist.o</span><br><span class="line">&#x2F;bin&#x2F;sh: cc: command not found</span><br><span class="line">make[1]: *** [adlist.o] Error 127</span><br><span class="line">make[1]: Leaving directory &#96;&#x2F;root&#x2F;redis-5.0.9&#x2F;src&#39;</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure><ul><li>yum安装gcc</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 redis-5.0.9]# yum install gcc</span><br></pre></td></tr></table></figure><ul><li>再次运行make编译命令，可能遇到以下错误</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cd src &amp;&amp; make all</span><br><span class="line">make[1]: Entering directory &#96;&#x2F;root&#x2F;redis-5.0.9&#x2F;src&#39;</span><br><span class="line">    CC Makefile.dep</span><br><span class="line">make[1]: Leaving directory &#96;&#x2F;root&#x2F;redis-5.0.9&#x2F;src&#39;</span><br><span class="line">make[1]: Entering directory &#96;&#x2F;root&#x2F;redis-5.0.9&#x2F;src&#39;</span><br><span class="line">    CC adlist.o</span><br><span class="line">In file included from adlist.c:34:0:</span><br><span class="line">zmalloc.h:50:31: fatal error: jemalloc&#x2F;jemalloc.h: No such file or directory</span><br><span class="line"> #include &lt;jemalloc&#x2F;jemalloc.h&gt;</span><br><span class="line">                               ^</span><br><span class="line">compilation terminated.</span><br><span class="line">make[1]: *** [adlist.o] Error 1</span><br><span class="line">make[1]: Leaving directory &#96;&#x2F;root&#x2F;redis-5.0.9&#x2F;src&#39;</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure><ul><li>执行以下代码进行编译</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 redis-5.0.9]# make MALLOC&#x3D;libc</span><br></pre></td></tr></table></figure><ul><li>没有错误后，安装命令</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 redis-5.0.9]# make install</span><br></pre></td></tr></table></figure><h2 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h2><ul><li>编辑redis.conf文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 redis-5.0.9]# vi redis.conf</span><br></pre></td></tr></table></figure><ul><li>修改以下配置</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># redis后台运行</span><br><span class="line">daemonize yes</span><br><span class="line"># 添加ip</span><br><span class="line">bind 127.0.0.1 192.168.136.128</span><br></pre></td></tr></table></figure><ul><li>允许远程访问redis</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查看防火墙6379端口是否开启</span><br><span class="line">[root@xukun94 redis-5.0.9]# firewall-cmd --query-port&#x3D;6379&#x2F;tcp</span><br><span class="line">no</span><br><span class="line"># 开启防火墙6379端口</span><br><span class="line">[root@xukun94 redis-5.0.9]# firewall-cmd --zone&#x3D;public --add-port&#x3D;6379&#x2F;tcp --permanent</span><br><span class="line">success</span><br><span class="line"># 重启防火墙</span><br><span class="line">[root@xukun94 redis-5.0.9]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line"># 再次查看防火墙6379端口是否开启</span><br><span class="line">[root@xukun94 redis-5.0.9]# firewall-cmd --query-port&#x3D;6379&#x2F;tcp</span><br><span class="line">yes</span><br></pre></td></tr></table></figure><ul><li>启动redis</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 redis-5.0.9]# redis-server redis.conf</span><br></pre></td></tr></table></figure><ul><li>登录redis，验证是否安装成功</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 redis-5.0.9]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; exit</span><br></pre></td></tr></table></figure><ul><li>关闭服务器</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xukun94 redis-5.0.9]# redis-cli shutdown</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;MariaDB安装与配置&quot;&gt;&lt;a href=&quot;#MariaDB安装与配置&quot; class=&quot;headerlink&quot; title=&quot;MariaDB安装与配置&quot;&gt;&lt;/a&gt;MariaDB安装与配置&lt;/h1&gt;&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;
      
    
    </summary>
    
    
      <category term="工具安装" scheme="http://xukun.fun/categories/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85/"/>
    
    
      <category term="MariaDB" scheme="http://xukun.fun/tags/MariaDB/"/>
    
      <category term="JDK" scheme="http://xukun.fun/tags/JDK/"/>
    
      <category term="Redis" scheme="http://xukun.fun/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Shiro修改角色权限清除缓存问题</title>
    <link href="http://xukun.fun/2020/07/17/Shiro%E4%BF%AE%E6%94%B9%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/"/>
    <id>http://xukun.fun/2020/07/17/Shiro%E4%BF%AE%E6%94%B9%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/</id>
    <published>2020-07-17T05:25:40.000Z</published>
    <updated>2020-07-19T04:41:08.233Z</updated>
    
    <content type="html"><![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>​    使用Shiro中shiro:hasPermission标签，修改角色权限后相同角色下各个用户权限不一致问题。在角色管理中修改当前登陆人的角色权限，当前用户的权限更新了，但是这个角色下其它用户的权限还是修改前的权限。</p><h1 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h1><p>​    shiro:hasPermission进行比较权限时，先通过CacheManager获取了Redis中的当前用户的权限缓存。</p><img src="/2020/07/17/Shiro%E4%BF%AE%E6%94%B9%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/20200717142806.png" class=""><p>​    而更新角色权限后，调用Realm中的内置的clearCache方法清除权限缓存，只清除了当前用户的权限缓存。</p><img src="/2020/07/17/Shiro%E4%BF%AE%E6%94%B9%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/20200717135435.png" class=""><h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>​    需要清除该角色下所有用户的权限缓存，通过RedisSessionDAO获取所有用户信息，然后循环清除用户权限缓存。若需要清除指定用户权限缓存，可将SimplePrincipalCollection对象强转成用户对象，再根据传入用户主键集合判断是否需要清除权限缓存。</p><img src="/2020/07/17/Shiro%E4%BF%AE%E6%94%B9%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/20200717140127.png" class="">]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h1&gt;&lt;p&gt;​    使用Shiro中shiro:hasPermission标签，修改角色权限后相同角色下各个用户权限不一致问题。在角色
      
    
    </summary>
    
    
      <category term="问题记录" scheme="http://xukun.fun/categories/%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="Shiro" scheme="http://xukun.fun/tags/Shiro/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis-Plus分页多次查询获取相同数据问题</title>
    <link href="http://xukun.fun/2020/03/17/Mybatis-Plus%E5%88%86%E9%A1%B5%E5%A4%9A%E6%AC%A1%E6%9F%A5%E8%AF%A2%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%90%8C%E6%95%B0%E6%8D%AE%E9%97%AE%E9%A2%98/"/>
    <id>http://xukun.fun/2020/03/17/Mybatis-Plus%E5%88%86%E9%A1%B5%E5%A4%9A%E6%AC%A1%E6%9F%A5%E8%AF%A2%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%90%8C%E6%95%B0%E6%8D%AE%E9%97%AE%E9%A2%98/</id>
    <published>2020-03-17T05:53:33.000Z</published>
    <updated>2020-03-17T06:23:38.997Z</updated>
    
    <content type="html"><![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>​    使用MyBatis-Plus 3.1.0，在做一个千万级数据从MySQL导入ElasticSearch的测试脚本中，由于数据量过大，不能一次获取，所以需要分页，循环递增页码来获取数据中发现每次分页查询结果都一样。</p><h1 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h1><p>​    MyBatis 判断是否需要使用一级缓存的代码早于 MyBatis-Plus 分页插件拦截的代码执行，导致获取的结果一直都是一级缓存中的数据。</p><img src="/2020/03/17/Mybatis-Plus%E5%88%86%E9%A1%B5%E5%A4%9A%E6%AC%A1%E6%9F%A5%E8%AF%A2%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%90%8C%E6%95%B0%E6%8D%AE%E9%97%AE%E9%A2%98/20200317140837.png" class=""><img src="/2020/03/17/Mybatis-Plus%E5%88%86%E9%A1%B5%E5%A4%9A%E6%AC%A1%E6%9F%A5%E8%AF%A2%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%90%8C%E6%95%B0%E6%8D%AE%E9%97%AE%E9%A2%98/20200317140911.png" class=""><h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>​    在对应XML的SELECT标签中，加入flushCache=”true”属性，调用此查询方法会自动清除一级缓存和二级缓存。</p><img src="/2020/03/17/Mybatis-Plus%E5%88%86%E9%A1%B5%E5%A4%9A%E6%AC%A1%E6%9F%A5%E8%AF%A2%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%90%8C%E6%95%B0%E6%8D%AE%E9%97%AE%E9%A2%98/20200317141226.png" class="">]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h1&gt;&lt;p&gt;​    使用MyBatis-Plus 3.1.0，在做一个千万级数据从MySQL导入ElasticSearch的测试脚本中
      
    
    </summary>
    
    
      <category term="问题记录" scheme="http://xukun.fun/categories/%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="MyBatis-Plus" scheme="http://xukun.fun/tags/MyBatis-Plus/"/>
    
  </entry>
  
</feed>
