[{"title":"Shiro修改角色权限清除缓存问题","date":"2020-07-17T05:25:40.000Z","path":"2020/07/17/Shiro修改角色权限清除缓存问题/","text":"问题描述​ 使用Shiro中shiro:hasPermission标签，修改角色权限后相同角色下各个用户权限不一致问题。在角色管理中修改当前登陆人的角色权限，当前用户的权限更新了，但是这个角色下其它用户的权限还是修改前的权限。 问题原因​ shiro:hasPermission进行比较权限时，先通过CacheManager获取了Redis中的当前用户的权限缓存。 ​ 而更新角色权限后，调用Realm中的内置的clearCache方法清除权限缓存，只清除了当前用户的权限缓存。 解决方案​ 需要清除该角色下所有用户的权限缓存，通过RedisSessionDAO获取所有用户信息，然后循环清除用户权限缓存。若需要清除指定用户权限缓存，可将SimplePrincipalCollection对象强转成用户对象，再根据传入用户主键集合判断是否需要清除权限缓存。","tags":[{"name":"MyBatis-Plus","slug":"MyBatis-Plus","permalink":"http://xukun.fun/tags/MyBatis-Plus/"}]},{"title":"Mybatis-Plus分页多次查询获取相同数据问题","date":"2020-03-17T05:53:33.000Z","path":"2020/03/17/Mybatis-Plus分页多次查询获取相同数据问题/","text":"问题描述​ 使用MyBatis-Plus 3.1.0，在做一个千万级数据从MySQL导入ElasticSearch的测试脚本中，由于数据量过大，不能一次获取，所以需要分页，循环递增页码来获取数据中发现每次分页查询结果都一样。 问题原因​ MyBatis 判断是否需要使用一级缓存的代码早于 MyBatis-Plus 分页插件拦截的代码执行，导致获取的结果一直都是一级缓存中的数据。 解决方案​ 在对应XML的SELECT标签中，加入flushCache=”true”属性，调用此查询方法会自动清除一级缓存和二级缓存。","tags":[{"name":"MyBatis-Plus","slug":"MyBatis-Plus","permalink":"http://xukun.fun/tags/MyBatis-Plus/"}]}]